<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bengaluru Lake Monitor</title>
    <style>
        /* CSS Styles for the Dashboard */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        
        .dashboard-card { 
            background: white; 
            padding: 40px; 
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            width: 400px; 
            text-align: center; 
        }

        h1 { color: #2c3e50; font-size: 24px; margin-bottom: 5px; }
        .subtitle { color: #7f8c8d; font-size: 14px; margin-bottom: 30px; }

        .status-badge { 
            display: inline-block; 
            padding: 8px 20px; 
            border-radius: 50px; 
            font-weight: bold; 
            color: white; 
            background-color: #95a5a6; /* Default Grey */
            margin-bottom: 25px;
        }

        .data-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 15px 0; 
            border-bottom: 1px solid #eee; 
        }
        
        .label { color: #7f8c8d; font-weight: 500; }
        .value { font-weight: bold; color: #2c3e50; }

        button { 
            background: #3498db; 
            color: white; 
            border: none; 
            padding: 12px 30px; 
            border-radius: 8px; 
            font-size: 16px; 
            cursor: pointer; 
            margin-top: 30px; 
            transition: background 0.3s;
        }
        button:hover { background: #2980b9; }
    </style>
</head>
<body>

    <div class="dashboard-card">
        <h1 id="lakeName">Lake Monitor</h1>
        <div class="subtitle">Real-time Satellite Analysis</div>

        <div id="statusBadge" class="status-badge">Waiting for Data...</div>

        <div class="data-row">
            <span class="label">Water Area</span>
            <span id="area" class="value">---</span>
        </div>

        <div class="data-row">
            <span class="label">Turbidity Index (NDTI)</span>
            <span id="ndti" class="value">---</span>
        </div>

        <div class="data-row" style="border-bottom: none;">
            <span class="label">Data Source</span>
            <span id="source" class="value">---</span>
        </div>

        <button onclick="fetchData()">ðŸ”„ Analyze Live Data</button>
    </div>

    <script>
        async function fetchData() {
            const btn = document.querySelector("button");
            const badge = document.getElementById("statusBadge");
            
            btn.textContent = "Processing Satellite Image...";
            btn.disabled = true; // Prevent double clicking
            badge.style.backgroundColor = "#95a5a6";
            badge.textContent = "Analyzing...";

            try {
                // 1. Call the Python API
                const response = await fetch("http://127.0.0.1:8000/analyze/hebbal");
                const data = await response.json();

                // 2. Update the HTML with the JSON data
                document.getElementById("lakeName").textContent = data.lake_name;
                document.getElementById("area").textContent = data.area_hectares + " Hectares";
                document.getElementById("ndti").textContent = data.avg_ndti;
                document.getElementById("source").textContent = data.data_source;

                // 3. Update Status Color
               // Update the text to include "Status: "
                // 3. Update Status Color & Text
                badge.textContent = "Status: " + data.status;

                if (data.status === "Clear") {
                    // Green Style for Good Status
                    badge.style.backgroundColor = "#27ae60";
                    badge.style.color = "white";
                    badge.style.border = "none";
                } else {
                    // Neutral Style (White with Border) for Moderate/High
                    badge.style.backgroundColor = "white";
                    badge.style.color = "#2c3e50"; // Dark Grey Text
                    badge.style.border = "2px solid #2c3e50"; // Dark Border
                }

                btn.textContent = "ðŸ”„ Analyze Again";
                btn.disabled = false;

            } catch (error) {
                console.error("Error:", error);
                badge.textContent = "Connection Error";
                badge.style.backgroundColor = "#e74c3c";
                btn.textContent = "Retry";
                btn.disabled = false;
            }
        }
        
        // Auto-load on open
        fetchData();
    </script>

</body>
</html>